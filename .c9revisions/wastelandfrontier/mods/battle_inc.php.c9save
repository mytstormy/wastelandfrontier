{"ts":1374601459066,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n\n\t\tinclude_once 'mods/vehicleinfo.php';\n\t\tinclude_once 'mods/userinfo.php';\n\t\tinclude_once 'vehicleinfo.php';\n\t\tinclude_once 'userinfo.php';\n\n\n\t\t\n\t\t\t\n\t\t\n\t\t// pull mob info from $_POST[mob_id]\n\t\t\t// make sure mob still exists or is not locked by someone else\n\t\t\t$mob_id = $_POST['mob_id'];\n\t\t\t\t$mobsql = \"SELECT *\n\t\t\t\t\t\tFROM tbl_mobs, tbl_mob_types\n\t\t\t\t\t\tWHERE tbl_mobs.mob_type = tbl_mob_types.mob_type_id and mob_id = '$mob_id'\";\n\t\t\t$mobresult = mysql_query($mobsql) or die('Query failed. ' . mysql_error()); \n\t\t\t$mobinfo = mysql_fetch_array($mobresult,MYSQL_ASSOC);\n\t\t\t\n\t\t\t\t// check for mob lock - see if it is the user id - allow to proceed\n\t\t\t\t\t// if lock is 0, set to user id.\n\t\t\t\t\t// if lock is not 0 or not the user id, do not allow the battle :)\n\t\t\t\t\n\t\t\t\t$mob_lock_id = $mobinfo['mob_lock_id'];\n\t\t\t\tif(($mob_lock_id = 0) or ($mob_lock_id = $user_id)){// mob lock correct begin\n\t\t\t\tif($mob_lock_id = 0){\n\t\t\t\t\t// update if it is zero - so it will be locked\n\t\t\t\t$mobsqllock = \"UPDATE tbl_mobs SET mob_lock_id = '$user_id' WHERE mob_id = '$mob_id' LIMIT 1\";\n\t\t\t\t$mobresultlock = mysql_query($mobsqllock) or die('Query failed. ' . mysql_error()); \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t// check mob and vehicle locations\n\t\t\t\t$mob_loc_x = $mobinfo['mob_loc_x'];\n\t\t\t\t$mob_loc_y = $mobinfo['mob_loc_y'];\n\t\t\t\tif(($mob_loc_x = $vehicle_loc_x) and ($mob_loc_y = $vehicle_loc_y)){// locations match - proceed\n\t\t\t\t\t\n\n\t\t\t\t$mob_loot_group = $mobinfo['mob_type_loot_group'];\n\t\t\t\t// if mult drops are allowed - no for now - only 1.\n\t\t\t\t$mob_loot_qty = $mobinfo['mob_type_loot_qty'];\n\n\t\t\t\t$mob_hp = $mobinfo['mob_hp'];\n\t\t\t\t$mob_shield_hp = $mobinfo['mob_shield_hp'];\n\t\t\t\t\n\t\t\t\t$new_mob_hp = $mob_hp;\n\t\t\t\t$new_mob_shield_hp = $mob_shield_hp;\n\t\t\t\t\n\t\t\t\t$mob_attack_min = $mobinfo['mob_attack_min'];\n\t\t\t\t$mob_attack_max = $mobinfo['mob_attack_max'];\n\t\t\t\t$mob_attack_speed = $mobinfo['mob_attack_speed'];\n\t\t\t\t$mob_defense = $mobinfo['mob_defense'];\n\t\t\t\t\n\t\t\t\t$mob_exp = $mobinfo['mob_exp'];\n\t\t\t\t$mob_credits = $mobinfo['mob_credits'];\n\t\t\t\t$mob_level = $mobinfo['mob_level'];\n\t\t\t\t$mob_rarity = $mobinfo['mob_rarity'];\n\t\t\t\t\n\t\t\t\t// echo 'Mob ID is :' . $_POST['mob_id'] . '.<br />';\n\t\t\n\t\t// get vehicle info from vehicleinfo include\n\t\t\n\t\t$vehicle_core_hp = $vehiclelocation['vehicle_core_hp'];\n\t\t$vehicle_armor_hp = $vehiclelocation['vehicle_armor_hp'];\n\t\t$vehicle_shield_hp = $vehiclelocation['vehicle_shield_hp'];\n\t\t$vehicle_shield_regen = $vehiclelocation['vehicle_shield_regen'];\n\t\t$vehicle_attack_min = $vehiclelocation['vehicle_attack_min'];\n\t\t$vehicle_attack_max = $vehiclelocation['vehicle_attack_max'];\n\t\t$vehicle_attack_speed = $vehiclelocation['vehicle_attack_speed'];\n\t\t$vehicle_defense = $vehiclelocation['vehicle_defense'];\n\t\t\n\t\t$new_vehicle_shield_hp = $vehicle_shield_hp ;\n\t\t$new_vehicle_armor_hp = $vehicle_armor_hp ;\n\t\t$new_vehicle_core_hp = $vehicle_core_hp ;\n\n\n\t\t\t// declare the globals?\n\t\t\tglobal $mob_hp,$mob_shield_hp,$mob_attack_min,$mob_attack_max,$mob_attack_speed,$mob_defense;\n\t\t\tglobal $vehicle_core_hp,$vehicle_armor_hp,$vehicle_shield_hp,$vehicle_attack_min,$vehicle_attack_max,$vehicle_attack_speed,$vehicle_defense;\n\t\t\tglobal $new_vehicle_shield_hp,$new_vehicle_armor_hp,$new_vehicle_core_hp,$new_mob_shield_hp,$new_mob_hp;\n\t\t\tglobal $m_attack,$m_attack_fin,$m_attack_rem1,$m_attack_rem2;\n\t\t\tglobal $v_attack,$v_attack_fin,$v_attack_rem;\n\n// a couple functions?\nfunction m_attack_v()\n{\n\t\t\tglobal $mob_hp,$mob_shield_hp,$mob_attack_min,$mob_attack_max,$mob_attack_speed,$mob_defense;\n\t\t\tglobal $vehicle_core_hp,$vehicle_armor_hp,$vehicle_shield_hp,$vehicle_attack_min,$vehicle_attack_max,$vehicle_attack_speed,$vehicle_defense;\n\t\t\tglobal $new_vehicle_shield_hp,$new_vehicle_armor_hp,$new_vehicle_core_hp,$new_mob_shield_hp,$new_mob_hp;\n\t\t\tglobal $m_attack,$m_attack_fin,$m_attack_rem1,$m_attack_rem2;\n\t\t\tglobal $v_attack,$v_attack_fin,$v_attack_rem;\n\t\n\t\t\t\t\t\t$m_attack = rand($mob_attack_min, $mob_attack_max);\n\t\t\t\t\t\t$m_attack_fin = $m_attack - $vehicle_defense;\n\t\t\t\t\t\tif($m_attack_fin < 0){ $m_attack_fin = 0;}\n\t\t\t\t\t\techo 'The mob attacks you for ' . $m_attack_fin . ' points of damage.<br /><br />';\n\t\t\t\t\t\tif($vehicle_shield_hp > 0){\n\t\t\t\t\t\t\t// veh has shield - take from it first\n\t\t\t\t\t\t$new_vehicle_shield_hp = $vehicle_shield_hp - $m_attack_fin;\n\t\t\t\t\t\t\tif($new_vehicle_shield_hp < 0){\n\t\t\t\t\t\t\t\t// if veh shield is less than 0, fix it and take leftover from HP\n\t\t\t\t\t\t\t\t$new_vehicle_shield_hp = 0;\n\t\t\t\t\t\t\t\techo 'Your vehicle took ' . $vehicle_shield_hp . ' points shield damage.<br /><br />';\n\t\t\t\t\t\t\t\t$m_attack_rem1 = $m_attack_fin - $vehicle_shield_hp;\n\t\t\t\t\t\t\t\t$new_vehicle_armor_hp = $vehicle_armor_hp - $m_attack_rem1;\n\t\t\t\t\t\t\t\t\tif($new_vehicle_armor_hp < 0){\n\t\t\t\t\t\t\t\t\t\t// if veh armor less than 0 - set to 0 and take from the core\n\t\t\t\t\t\t\t\t\t\t$new_vehicle_armor_hp = 0;\n\t\t\t\t\t\t\t\t\t\techo 'Your vehicle also took ' . $vehicle_armor_hp . ' points armor damage.<br />';\n\t\t\t\t\t\t\t\t\t\t$m_attack_rem2 = $m_attack_rem1 - $vehicle_armor_hp;\n\t\t\t\t\t\t\t\t\t\t$new_vehicle_core_hp = $vehicle_core_hp - $m_attack_rem2;\n\t\t\t\t\t\t\t\t\t\techo 'Your vehicle also took ' . $m_attack_rem2 . ' points damage to the core structure.<br /><br />';\n\t\t\t\t\t\t\t\t\t}else{// if veh armor over 0, echo exact dmg to armor\n\t\t\t\t\t\t\t\t\techo 'Your vehicle also took ' . $m_attack_fin . ' points armor damage.<br /><br />';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else{//if veh shield over or = 0, echo exact dmg to shield\n\t\t\t\t\t\t\techo 'Your vehicle took ' . $m_attack_fin . ' points shield damage.<br /><br />';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}elseif($vehicle_armor_hp > 0){\n\t\t\t\t\t\t\t// no veh shield - right into the armor hp\n\t\t\t\t\t\t\t$new_vehicle_armor_hp = $vehicle_armor_hp - $m_attack_fin;\n\t\t\t\t\t\t\t\tif($new_vehicle_armor_hp < 0){\n\t\t\t\t\t\t\t\t\t// if veh armor less than 0 - fix it too and take from the core\n\t\t\t\t\t\t\t\t\t$new_vehicle_armor_hp = 0;\n\t\t\t\t\t\t\t\t\techo 'Your vehicle took ' . $vehicle_armor_hp . ' points armor damage.<br />';\n\t\t\t\t\t\t\t\t\t$m_attack_rem = $m_attack_fin - $vehicle_armor_hp;\n\t\t\t\t\t\t\t\t\t$new_vehicle_core_hp = $vehicle_core_hp - $m_attack_rem;\n\t\t\t\t\t\t\t\t\techo 'Your vehicle also took ' . $m_attack_rem . ' points damage to the core structure.<br /><br />';\n\t\t\t\t\t\t\t\t}else{// if veh armor over 0, echo exact dmg to armor\n\t\t\t\t\t\t\t\techo 'Your vehicle took ' . $m_attack_fin . ' points armor damage.<br /><br />';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// no veh shield or armor - right into the core hp - expensive!\n\t\t\t\t\t\t\t$new_vehicle_core_hp = $vehicle_core_hp - $m_attack_fin;\n\t\t\t\t\t\t\techo 'Your vehicle took ' . $m_attack_fin . ' points damage to the core structure.<br /><br />';\n\t\t\t\t\t\t}\n}\n\nfunction v_attack_m()\n{\n\t\t\tglobal $mob_hp,$mob_shield_hp,$mob_attack_min,$mob_attack_max,$mob_attack_speed,$mob_defense;\n\t\t\tglobal $vehicle_core_hp,$vehicle_armor_hp,$vehicle_shield_hp,$vehicle_attack_min,$vehicle_attack_max,$vehicle_attack_speed,$vehicle_defense;\n\t\t\tglobal $new_vehicle_shield_hp,$new_vehicle_armor_hp,$new_vehicle_core_hp,$new_mob_shield_hp,$new_mob_hp;\n\t\t\tglobal $m_attack,$m_attack_fin,$m_attack_rem1,$m_attack_rem2;\n\t\t\tglobal $v_attack,$v_attack_fin,$v_attack_rem;\n\t\n\t\t\t\t\t$v_attack = rand($vehicle_attack_min, $vehicle_attack_max);\n\t\t\t\t\t$v_attack_fin = $v_attack - $mob_defense;\n\t\t\t\t\tif($v_attack_fin < 0){ $v_attack_fin = 0;}\n\t\t\t\t\techo 'You attack the mob for ' . $v_attack_fin . ' points of damage.<br /><br />';\n\t\t\t\t\t//echo 'veh attack min/max: ' . $vehicle_attack_min . '/' . $vehicle_attack_max . ' points of damage.<br />';\n\t\t\t\t\t//echo 'Mob shield ' . $mob_shield_hp . ' points of damage.<br />';\n\t\t\t\t\tif($mob_shield_hp > 0){\n\t\t\t\t\t\t// mob has shield - take from it first\n\t\t\t\t\t  $new_mob_shield_hp = $mob_shield_hp - $v_attack_fin;\n\t\t\t\t\t\tif($new_mob_shield_hp < 0){\n\t\t\t\t\t\t  // if mob shield is less than 0, fix it and take leftover from HP\n\t\t\t\t\t\t  $new_mob_shield_hp = 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\t  $v_attack_rem = $v_attack_fin - $mob_shield_hp;\n\t\t\t\t\t\t  $new_mob_hp = $mob_hp - $v_attack_rem;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t  }else{\n\t\t\t\t\t\t// no mob shield - right into the hp\n\t\t\t\t\t\t$new_mob_hp = $mob_hp - $v_attack_fin;\n\t\t\t\t\t  }\n}\nfunction show_v_rem()\n{\n\t\t\tglobal $mob_hp,$mob_shield_hp,$mob_attack_min,$mob_attack_max,$mob_attack_speed,$mob_defense;\n\t\t\tglobal $vehicle_core_hp,$vehicle_armor_hp,$vehicle_shield_hp,$vehicle_attack_min,$vehicle_attack_max,$vehicle_attack_speed,$vehicle_defense;\n\t\t\tglobal $new_vehicle_shield_hp,$new_vehicle_armor_hp,$new_vehicle_core_hp,$new_mob_shield_hp,$new_mob_hp;\n\t\t\tglobal $m_attack,$m_attack_fin,$m_attack_rem1,$m_attack_rem2;\n\t\t\tglobal $v_attack,$v_attack_fin,$v_attack_rem;\n\t\necho 'Your vehicle retains ' . $new_vehicle_shield_hp . ' points of shield protection.<br />';\necho 'Your vehicle retains ' . $new_vehicle_armor_hp . ' points of armor protection.<br />';\necho 'Your vehicle retains ' . $new_vehicle_core_hp . ' points of core structure.<br /><br />';\n}\nfunction show_m_rem()\n{\n\t\t\tglobal $mob_hp,$mob_shield_hp,$mob_attack_min,$mob_attack_max,$mob_attack_speed,$mob_defense;\n\t\t\tglobal $vehicle_core_hp,$vehicle_armor_hp,$vehicle_shield_hp,$vehicle_attack_min,$vehicle_attack_max,$vehicle_attack_speed,$vehicle_defense;\n\t\t\tglobal $new_vehicle_shield_hp,$new_vehicle_armor_hp,$new_vehicle_core_hp,$new_mob_shield_hp,$new_mob_hp;\n\t\t\tglobal $m_attack,$m_attack_fin,$m_attack_rem1,$m_attack_rem2;\n\t\t\tglobal $v_attack,$v_attack_fin,$v_attack_rem;\n\t\necho 'The Mob retains ' . $new_mob_shield_hp . ' points of shield protection.<br />';\necho 'The Mob retains ' . $new_mob_hp . ' hit points.<br /><br />';\n}\n\n\t\t\n\t\t\n\t\t// check for battle type - in user info - user_battle_type,  auto=0, manual=1\n\t\t// ********************* battle if in this wrapper for auto or manual\n\t\tif($user_battle_type = 1){//begin manual wrapper\n\t\t\n\t\t// if manual, set some ssession vars to handle the battle text? \n\t\t\t\t// update the veh/mob stats each round though...\n\t\t\t\t\n\t\t\t\t// in manual mode - attack speed determines first attack, \n\t\t\t\t// its just 1 for 1 attacks, so speed doesnt reeally get to stack to the faster attacker's benefit\n\t\t\t\t// they do however get the benefit of first attack each time... nice for them :)\n\t\t\t\t\n\t\t\t\tif($vehicle_attack_speed < $mob_attack_speed){\n\t\t\t\t\t// vehicle attacks first \n\t\t\t\t\t\n\t\t\t\t\tv_attack_m();\n\t\t\t\t\t\n\t\t\t\t\tshow_m_rem();\n\t\t\t\t\t\n\t\t\t\t\t// mob attacks second if not dead...\n\t\t\t\t\tif($new_mob_hp <= 0){\n\t\t\t\t\t\t// mob is dead - end battle\n\t\t\t\t\t\t$new_mob_hp = 0;\n\t\t\t\t\t\techo 'The mob has been killed dead. /celebrate.<br /><br />';\n\t\t\t\t\t}else{\n\t\t\t\t\t\t\n\t\t\t\t\t\tm_attack_v();\n\t\t\t\t\t\t\n\t\t\t\t\t\tshow_v_rem();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// mob attacks first\n\t\t\t\t\tm_attack_v();\n\t\t\t\t\t\n\t\t\t\t\tshow_v_rem();\n\t\t\t\t\t\n\t\t\t\t\tif($new_vehicle_core_hp <= 0){\n\t\t\t\t\t\t// you is dead - end battle\n\t\t\t\t\t\t$new_vehicle_core_hp = 0;\n\t\t\t\t\t\techo 'You has been killed dead. /cry. <br /><br />';\n\t\t\t\t\t}else{\n\t\t\t\t\t\t\n\t\t\t\t\t\tv_attack_m();\n\t\t\t\t\t\t\n\t\t\t\t\t\tshow_m_rem();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// if mob and user not dead - give attack again button?\n\t\t\t\t\n\t\t\t\tif(($new_vehicle_core_hp > 0) and ($new_mob_hp > 0)){\n\t\t\t\t?>\n                  <form action=\"battle.php\" method=\"post\" name=\"battleform\">\n                  <input name=\"mob_id\" type=\"hidden\" value=\"<?php echo $mob_id; ?>\" />\n                  <input name=\"submit\" type=\"submit\" value=\"Fight Again\" />\n                  </form>\n\t\t\t\t<?php\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\t\t\techo \"<br /><br />\";\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//$new_vehicle_shield_hp = $vehicle_shield_hp ;\n\t\t\t\t//$new_vehicle_armor_hp = $vehicle_armor_hp ;\n\t\t\t\t//$new_vehicle_core_hp = $vehicle_core_hp ;\n\t\t\t\t// update mob and user stats\n\t\t\t\t$vehsqlup = \"UPDATE tbl_vehicles SET vehicle_core_hp = '$new_vehicle_core_hp', vehicle_armor_hp = '$new_vehicle_armor_hp', vehicle_shield_hp = '$new_vehicle_shield_hp' WHERE vehicle_id = '$vehicle_id' and vehicle_user_id = '$user_id' LIMIT 1\";\n\t\t\t\t$vehresultup = mysql_query($vehsqlup) or die('Query failed. ' . mysql_error()); \n\t\t\t\t\n\t\t\t\t//$new_mob_hp = $mob_hp;\n\t\t\t\t//$new_mob_shield_hp = $mob_shield_hp;\n\t\t\t\t$mobsqlup = \"UPDATE tbl_mobs SET mob_hp = '$new_mob_hp', mob_shield_hp = '$new_mob_shield_hp' WHERE mob_id = '$mob_id' LIMIT 1\";\n\t\t\t\t$mobresultup = mysql_query($mobsqlup) or die('Query failed. ' . mysql_error()); \n\t\t\t\t\n\t\t\t\n\t\t\t//end manual wrapper\t\n\t\t}else{//begin auto wrapper\n\t\t\n\t\t// for auto - use whiles and ifs :)\n\t\t\n\t\t\n\t\t}//end auto wrapper\t\t\t\n\t\t\t\n\t\t// ********************** end of battle reached here - manual or auto\n\t\t\n\t\t\t// if user still alive - \n\t\t\t\t\tif($new_mob_hp <= 0){\n\t\t\t\t\t\t// mob is dead - end battle\n\t\t\t\t\t\t// leave in the DB - let is be cleaned by the cron\n\t\t\t\t\t\t\t// leave lock in for lock id - salvaging before the cron cleans up...\n\t\t\t\t\t\t\n\t\t\t\t\t\t// create loot\n\t\t\t\t\t\t\t// pull loot in loot table from loot group, just pull item type id's\n\t\t\t\t\t\t\t// select from where - mob_loot_group = item_type_loot_group\n\t\t\t\t\t\t\t\t\n\n\t\t\t\t// test loot generation\n\t\t\t\t\t\t// create loot\n\t\t\t\t\t\t// currently only create one item if random allows,\n\t\t\t\t\t\t// eventually - some mobs can drop mult items... see mob_type_loot_qty vs item_type_loot_qty\n\t\t\t\t\t\t\t// pull loot in loot table from loot group, just pull item type id's\n\t\t\t\t\t\t\t// select from where - mob_loot_group = item_type_loot_group\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$lootsql = \"SELECT item_type_id\n\t\t\t\t\t\t\t\tFROM tbl_item_types\n\t\t\t\t\t\t\t\tWHERE item_type_loot_group = $mob_loot_group\";\n\t\t\t\t\t\t\t\t$lootresult = mysql_query($lootsql) or die('Query failed. ' . mysql_error()); \n\t\t\t\t\t\t\t\t// $lootinfo = mysql_fetch_array($lootresult,MYSQL_ASSOC);\n\n\t\t\t\t\t\t\t\t$lootarray = array();\n\t\t\t\t\t\t\t\twhile($lootinfo = mysql_fetch_array($lootresult,MYSQL_ASSOC)){\n\t\t\t\t\t\t\t\t\t// array_push($lootarray, $lootinfo[item_type_id]);\n\t\t\t\t\t\t\t\t\t$lootarray[] = $lootinfo[item_type_id];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// eventually pull this padding from the %'s for the drop chance...\n\t\t\t\t\t\t\t\t\t$padding = 5;\n\t\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\t\twhile($i < $padding){\n\t\t\t\t\t\t\t\t\t// array_push($lootarray, $lootinfo[item_type_id]);\n\t\t\t\t\t\t\t\t\t$lootarray[] = 0;\n\t\t\t\t\t\t\t\t\t$i = $i +1;\n\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// do shuffle() on that array\n\t\t\t\t\t\t\t\tshuffle($lootarray);\n\t\t\t\t\t\t\t\techo \"Random Loot id: \";\n\t\t\t\t\t\t\t\t$random1 = $lootarray[0];\n\t\t\t\t\t\t\t\techo $random1;\n\t\t\t\t\t\t\t\techo \"<br /><br />\";\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// if not a 0 - you get an item...\n\t\t\t\t\t\t\t\tif($random1 != 0){\n\t\t\t\t\t\t\t\techo \"You win loots!<br />\";\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// for each item - need to get qty for insert - is in tbl_item_types\n\t\t\t\t\t\t\t\t$itemlootsql = \"SELECT item_type_id, item_type_loot_qty\n\t\t\t\t\t\t\t\tFROM tbl_item_types\n\t\t\t\t\t\t\t\tWHERE item_type_id = $random1\";\n\t\t\t\t\t\t\t\t$itemlootresult = mysql_query($itemlootsql) or die('Query failed. ' . mysql_error()); \n\t\t\t\t\t\t\t\t$itemlootinfo = mysql_fetch_array($itemlootresult,MYSQL_ASSOC);\n\t\t\t\t\t\t\t\t$item_loot_qty = $itemlootinfo[item_type_loot_qty];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// create item of the first type in the array\n\t\t\t\t\t\t\t\t// for now - just insert - no stacking items...\n\t\t\t\t\t\t\t\t$sqlinsert = \"INSERT INTO tbl_items \n\t\t\t\t\t\t\t\t(item_user_id, item_type_id, item_status, item_location, item_qty)\n\t\t\t\t\t\t\t\tVALUES('$user_id', '$random1', '1', '0', '$item_loot_qty')\";\n\t\n\t\t\t\t\t\t\t\t$resultinsert = mysql_query($sqlinsert) or die('Query failed. ' . mysql_error()); \n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\techo \"No loot for you. -_- (signed - The Loot Natzi)<br />\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\techo \"<br /><br />\";\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\techo \"Whole list - Random: <br />\";\n\t\t\t\t\t\t\t\tforeach ($lootarray as $item_id) {\n\t\t\t\t\t\t\t\techo \"$item_id \";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\techo \"<br /><br />\";\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t// $mob_exp = $mobinfo['mob_exp'];\n\t\t\t\t\t\t// $mob_credits = $mobinfo['mob_credits'];\n\t\t\t\t\t\t\n\t\t\t\t\t\t// award credits if any\n\t\t\t\t\t\t\t// rand() from 0 to max credits\\\n\t\t\t\t\t\t\t// plus x% from user's vendor skill?\n\t\t\t\t\t\t\t$plus_credits = $mob_credits + 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// award exp also\n\t\t\t\t\t\t\t// flat amount + any bonuses to exp...\n\t\t\t\t\t\t\t\t// maybe a rested bonus?\n\t\t\t\t\t\t\t\t// pay/donator bonuses?\n\t\t\t\t\t\t\t\t$plus_exp = $mob_exp + 0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t$new_user_gen_exp = $user_gen_exp + $plus_exp;\n\t\t\t\t\t\t$new_user_credits = $user_credits + $plus_credits;\n\t\t\t\t\t\t$query = \"UPDATE tbl_users SET user_gen_exp = '$new_user_gen_exp', user_credits = '$new_user_credits' WHERE user_id = '$user_id' LIMIT 1\";\n\t\t\t\t\t\t$adjustuser =  mysql_query($query) or die('Query failed. ' . mysql_error());\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t$new_mob_hp = 0;\n\t\t\t\t\t\techo 'You have been awarded ' . $plus_credits . '/' . $plus_exp . ' - credits/exp. /celebrate.<br /><br />';\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// if user died\n\t\t\t\t// still award exp\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t}else{// locations dont match - throw error\n\t\t\t\techo 'Either your vehicle has moved, or the mob has moved. Please check your location again.<br />';\n\t\t\t\t}// end location check\n\n\t\t\t\t}else{// mob lock not allowed - show error\n\t\t\t\techo 'This mob is currently engaged by another user, check back in a few minutes.<br />';\n\t\t\t\t}// end mob lock not allowed\n\n\n\n\n\t\techo 'Still in the works... anything that does show up here is not updated in the db yet... mob fights will be here soon :)';\n\n\n?>"]],"start1":0,"start2":0,"length1":0,"length2":16698}]],"length":16698}
{"contributors":[],"silentsave":true,"ts":1374601328743,"patch":[[{"diffs":[[0,"<?php\n"],[1,"// comment added in c9.io - testing sync settings...\n\n"],[0,"\n\t\tinclu"]],"start1":0,"start2":0,"length1":14,"length2":68}]],"length":16752,"saved":false}
{"ts":1374601331369,"patch":[[{"diffs":[[0,"ngs...\n\n"],[-1,"\n"],[0,"\t\tinclud"]],"start1":52,"start2":52,"length1":17,"length2":16}]],"length":16751,"saved":false}
{"ts":1374601659446,"patch":[[{"diffs":[[0,"ings...\n"],[1,"t"],[0,"\n\t\tinclu"]],"start1":51,"start2":51,"length1":16,"length2":17}]],"length":16752,"saved":false}
{"ts":1374601697407,"patch":[[{"diffs":[[0,"ings...\n"],[-1,"t"],[0,"\n\t\tinclu"]],"start1":51,"start2":51,"length1":17,"length2":16}]],"length":16751,"saved":false}
{"ts":1374601705192,"patch":[[{"diffs":[[0,"ngs...\n\n"],[1,"\n"],[0,"\t\tinclud"]],"start1":52,"start2":52,"length1":16,"length2":17}]],"length":16752,"saved":false}
